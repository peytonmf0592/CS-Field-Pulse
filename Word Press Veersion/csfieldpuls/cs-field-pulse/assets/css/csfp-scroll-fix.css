/* CS Field Pulse - Scroll Capture Fix for iOS Safari */

/* ========================================
   Global Scroll Fix - Prevent Nested Scrolling
   ======================================== */
@media (max-width: 640px) {
    /* Main container should use page scroll */
    html, body {
        overflow-x: hidden;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: auto;
    }
    
    /* Main container - no nested scroll */
    .csfp-container {
        overflow: visible !important;
        height: auto !important;
        min-height: 100vh;
        -webkit-overflow-scrolling: inherit;
    }
    
    /* Dashboard containers - prevent scroll trap */
    .csfp-dashboard-compact,
    .csfp-dashboard-main,
    .csfp-dashboard-sidebar {
        overflow: visible !important;
        height: auto !important;
        -webkit-overflow-scrolling: inherit;
    }
    
    /* Chart containers - no scroll */
    .csfp-chart-container-compact,
    .csfp-chart-wrapper-compact,
    .csfp-glass {
        overflow: visible !important;
        -webkit-overflow-scrolling: inherit;
        touch-action: pan-y pan-x;
    }
    
    /* Activity list - the ONLY scrollable area */
    .csfp-activity-scroll {
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        touch-action: pan-y;
    }
    
    /* Map container - special handling */
    .csfp-map-container-compact {
        overflow: visible !important;
        touch-action: none; /* Disabled until guard removed */
    }
    
    .csfp-map-wrap {
        position: relative;
        overflow: hidden;
        touch-action: none; /* Disabled until guard removed */
    }
    
    /* Map with guard active - no interaction */
    #csfp-map {
        touch-action: none;
        pointer-events: none;
    }
    
    /* Map interactive - allow gestures */
    #csfp-map.interactive {
        touch-action: pan-x pan-y pinch-zoom;
        pointer-events: auto;
    }
}

/* ========================================
   Touch Action Controls
   ======================================== */
@media (max-width: 640px) {
    /* Default touch behavior for most elements */
    .csfp-card,
    .csfp-stat-card,
    .csfp-activity-card {
        touch-action: manipulation;
    }
    
    /* Charts - allow pan but no zoom */
    canvas {
        touch-action: pan-x pan-y;
    }
    
    /* Buttons and links */
    button,
    a,
    .csfp-btn {
        touch-action: manipulation;
    }
    
    /* Form controls */
    input,
    select,
    textarea {
        touch-action: manipulation;
    }
}

/* ========================================
   iOS-Specific Scroll Behavior
   ======================================== */
@supports (-webkit-touch-callout: none) {
    @media (max-width: 640px) {
        /* iOS Safari specific fixes */
        .csfp-container {
            position: relative;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        /* Prevent elastic scroll on containers */
        .csfp-dashboard-compact,
        .csfp-dashboard-main,
        .csfp-dashboard-sidebar {
            position: relative;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        /* Fix for iOS momentum scrolling */
        body {
            position: relative;
            height: 100%;
        }
    }
}

/* ========================================
   Map Guard Overlay Improvements
   ======================================== */
@media (max-width: 640px) {
    .csfp-map-guard {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(2px);
        -webkit-backdrop-filter: blur(2px);
        z-index: 10;
        cursor: pointer;
        touch-action: manipulation;
    }
    
    .csfp-map-guard-text {
        background: rgba(26, 26, 26, 0.95);
        color: #fff;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        pointer-events: none;
    }
    
    /* When guard is hidden */
    .csfp-map-guard.hidden {
        display: none !important;
    }
}

/* ========================================
   Prevent Horizontal Scroll
   ======================================== */
@media (max-width: 640px) {
    * {
        max-width: 100vw !important;
    }
    
    .csfp-container > * {
        max-width: 100% !important;
    }
}

/* ========================================
   Activity Feed Scroll Boundary
   ======================================== */
@media (max-width: 640px) {
    /* Create scroll boundary for activity feed */
    .csfp-recent-activity-compact {
        position: relative;
        isolation: isolate;
    }
    
    /* Gradient fade at bottom of scroll area */
    .csfp-activity-scroll::after {
        content: '';
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(to bottom, transparent, rgba(26, 26, 26, 0.9));
        pointer-events: none;
        z-index: 1;
    }
    
    /* Ensure Load More is below scroll area */
    .csfp-activity-pagination {
        position: relative;
        z-index: 2;
        background: rgba(26, 26, 26, 0.95);
        padding-top: 0.5rem;
    }
}